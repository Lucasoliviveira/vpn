#!/bin/bash
clear

[[ "$(whoami)" != "root" ]] && {
  echo -e "\033[1;37m[\033[1;31mErro\033[1;37m] - você precisa executar como root\033[0m"
  sleep 2
  rm $HOME/Plus > /dev/null 2>&1
  exit 0
}

_lnk=$(echo 'z1:y#x.5s0ul&p4hs$s.0a72d*n-e!v89e032:3r' | sed -e 's/[^a-z.]//ig' | rev)
_Ink=$(echo '/3×u3#s87r/l32o4×c1a×l1/83×l24×i0b×' | sed -e 's/[^a-z/]//ig')
_1nk=$(echo '/3×u3#s×87r/83×l2×4×i0b×' | sed -e 's/[^a-z/]//ig')

# Função de barra de progresso com efeitos visuais
fun_bar() {
  comando[0]="$1"
  comando[1]="$2"
  (
    [[ -e $HOME/fim ]] && rm $HOME/fim
    ${comando[0]} -y > /dev/null 2>&1
    ${comando[1]} -y > /dev/null 2>&1
    touch $HOME/fim
  ) > /dev/null 2>&1 &
  
  tput civis
  echo -ne "\033[1;37m  AGUARDE - ["
  while true; do
    for i in $(seq 1 18); do
      echo -ne "\033[1;31m#"
      sleep 0.1s
    done
    [[ -e $HOME/fim ]] && rm $HOME/fim && break
    echo -e "\033[1;37m]"
    tput cuu1
    tput dl1
    echo -ne "\033[1;37m  AGUARDE - ["
  done
  echo -e "\033[1;37m] -\033[1;32m OK!\033[1;37m"
  tput cnorm
}

# Função de cabeçalho estilizado
function cabecalho() {
  clear
  echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
  echo -e "\033[1;32m               ⇱ BEM VINDO AO SSH PLUS!! ⇲          \033[0m"
  echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
  echo ""
}

# Verificação de chave
function verif_key() {
  krm=$(echo '5:q-3gs2.o7%8:1' | rev)
  chmod +x $_Ink/list > /dev/null 2>&1
  [[ ! -e "$_Ink/list" ]] && {
    echo -e "\n\033[1;31mKEY INVÁLIDA!\033[0m"
    rm -rf $HOME/Plus > /dev/null 2>&1
    clear
    exit 1
  }
}

# Otimização do Python
otimize_python() {
  apt install pip -y
  apt install python3-pip -y
  pip install speedtest-cli
  apt install uuid-runtime
  apt install socat -y
  apt-get install python-minimal -y >/dev/null 2>&1
  apt-get install libpython-stdlib -y >/dev/null 2>&1
  apt-get install python -y >/dev/null 2>&1
  apt-get install python2 -y >/dev/null 2>&1
  apt-get install python3.6 -y >/dev/null 2>&1
  apt-get install python3.7 -y >/dev/null 2>&1
  apt-get install python3.8 -y >/dev/null 2>&1
  apt-get install python3.9 -y >/dev/null 2>&1
  update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.6 1 >/dev/null 2>&1
  update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 3 >/dev/null 2>&1
  update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.7 2 >/dev/null 2>&1
  update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 4 >/dev/null 2>&1
  update-alternatives --set python3 /usr/bin/python3.6
}

# Início do script
cabecalho
echo -e "             \033[1;31mATENÇÃO! \033[1;37mESSE SCRIPT IRÁ:\033[0m"
echo ""
echo -e "\033[1;31m• \033[1;37mINSTALAR UM CONJUNTO DE SCRIPTS COMO FERRAMENTAS\033[0m"
echo -e "\033[1;37m  PARA O GERENCIAMENTO DE REDE, SISTEMA E USUÁRIOS\033[0m"
echo ""
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
echo -e "             \033[1;37m • \033[1;32mEDIT: @LUCAS\033[1;37m •             "
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
echo ""

# Continuar ou sair
echo -ne "\033[38;5;118mENTER \033[1;37mpara continuar a \033[1;31mINSTALAÇÃO: \033[0m"
read x
[[ $x = @(n|N) ]] && exit

# Atualização do sistema
echo -e "\033[1;33mIniciando atualização do sistema...\033[0m"
fun_bar "apt-get update"

# Instalação de pacotes
echo -e "\033[1;33mInstalando pacotes necessários...\033[0m"
inst_pct() {
  _pacotes=("bc" "screen" "nano" "unzip" "lsof" "netstat" "net-tools" "dos2unix" "nload" "jq" "curl" "figlet" "python3" "python-pip" "firewalld")
  for _prog in ${_pacotes[@]}; do
    apt install $_prog -y > /dev/null 2>&1
  done
  pip install speedtest-cli > /dev/null 2>&1
}
fun_bar "inst_pct"

# Finalização
clear
echo ""
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
echo -e "\033[1;32m               INSTALAÇÃO CONCLUÍDA!                \033[0m"
echo -e "\033[1;33mDIGITE: \033[1;36mmenu\033[1;33m PARA COMEÇAR\033[0m"
echo -e "\033[1;37m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\033[0m"
rm $HOME/Plus && cat /dev/null > ~/.bash_history && history -c
